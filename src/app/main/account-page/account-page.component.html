<div class="content">
    <div class="wrapper">
        <div class="general-chart">
            <div *ngIf="sumValue" class="title-wrapper">
                <div class="title">
                    Total Balance
                </div>
                <div class="description">
                    {{this.sumValue}} XDR
                </div>
            </div>
            <div class="chart">
                <canvas baseChart
                        [options]="doughnutChartOptions"
                        [data]="doughnutChartData"
                        [labels]="doughnutChartLabels"
                        [datasets]="datasets"
                        [chartType]="doughnutChartType"></canvas>
            </div>
        </div>
<!--        <div class="table-chart">-->
<!--            <div style="width: 100%">-->
<!--                <canvas baseChart-->
<!--                        [options]="barChartOptions"-->
<!--                        [colors]="barChartColors"-->
<!--                        [data]="ChartData"-->
<!--                        [labels]="ChartLabels"-->
<!--                        [chartType]="ChartType"></canvas>-->
<!--            </div>-->
<!--        </div>-->
        <div class="controls-table">
            <div class="search">
                <mat-form-field>
                    <i class="fas fa-search icon"></i>
                    <input placeholder="Search" type="text" matInput [(ngModel)]="searchValue" (ngModelChange)="search()">
                </mat-form-field>
            </div>
            <div class="hide-low-balance">
                <mat-checkbox [checked]="hideLowBalanceFlag" (change)="isHideLowBalanceCheckbox($event)">
                    <span style="word-break: break-all;" class="">Hide low balance assets</span>
                </mat-checkbox>
            </div>
        </div>
        <div class="table-wrapper">
            <div class="table">
                <div class="row title">
                    <div class="cell">

                    </div>
                    <div class="cell">
                        Balance
                    </div>
                    <div class="cell">
                        %
                    </div>
                    <div class="cell">
                        Value(XDR)
                    </div>
<!--                    <div class="cell">-->
<!--                        Change 30D-->
<!--                    </div>-->
                    <div class="cell">

                    </div>
                </div>

                <div class="row" *ngFor="let item of arraySearchValue" [ngClass]="{'hide': this.hideLowBalanceFlag && item.balance === '0'}" (click)="drawingChart('ALL', 30,'days')">
                    <div class="cell" [ngClass]="{'empty': !item.icon}">
                        <img class="icon" [ngClass]="item.code" [src]="item.icon" alt="">
                        <div class="empty-state"></div>
                        <div class="name-currency">
                            {{item.code}}
                        </div>
                    </div>
                    <div class="cell">
                        {{item.balance === '0' ? '-' : item.balance}}
                    </div>
                    <div class="cell">
                        {{item.balance == '0' ? '-' : item.percent}}
                    </div>
                    <div class="cell">
                        {{item.value == '0' ? '-' : item.value}}
                    </div>
<!--                    <div class="cell">-->
<!--                        {{item.balance === '0' ? '-' : item.change + '%'}}-->
<!--                    </div>-->
                    <div class="cell">
                        <div class="buttons-group">
                            <div class="button-convert" [ngClass]="{'disabled' : !item.deposit.enabled}" (click)="openModal($event, item, 'deposit');">
                                <div class="text">
                                    {{item.trustline ? 'Deposit': 'Accept'}}
                                </div>
                            </div>
                            <div class="button-convert" [ngClass]="{'disabled' : item.balance === '0' || !item.withdraw.enabled}" (click)="openModal($event, item, 'withdraw');">
                                <div class="text">
                                    Withdraw
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row title">
                    <div class="cell">
                        Total
                    </div>
                    <div class="cell">

                    </div>
                    <div class="cell">

                    </div>
                    <div class="cell">
                        {{sumValue}}
                    </div>
<!--                    <div class="cell">-->
<!--                        {{sumChange}}%-->
<!--                    </div>-->
                    <div class="cell">

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<modal id="withdraw">
    <div class="modal">
        <div class="modal-body">
            <div class="head-popup">
                Withdraw
                <div class="close" (click)="modalService.close('withdraw');">
                    <i class="fas fa-times icon-close"></i>
                </div>
            </div>
            <div class="content-popup">
                <form [formGroup]="withdrawForm" class="operations-modal" (ngSubmit)="sendWithdrawForm()">
                    <mat-form-field class="full-width">
                        <input matInput placeholder="Recipient's {{currentToken.code}} Address" formControlName="recipient"  value="">
                    </mat-form-field>
                    <div class="amount">
                        <div class="balance">
                            <div class="text">
                                Available Balance
                            </div>
                            <div class="text currency" (click)="addFullBalance(currentToken.balance)">
                                {{currentToken.balance}} {{currentToken.code}}
                            </div>
                        </div>
                        <div class="min">
                            Minimum Withdrawal: {{this.currentToken.withdraw.min_amount}} {{currentToken.code}}
                        </div>
                        <mat-form-field class="full-width">
                            <input matInput placeholder="Amount" maxlength="18" formControlName="amount" autocomplete="off" value="">
                        </mat-form-field>
                        <div *ngIf="_amount.invalid && (_amount.touched || _amount.dirty)">
                            <span class="error" *ngIf="_amount.errors?.required">
                                Field cannot be empty
                            </span>
                            <span class="error" *ngIf="_amount.errors?.min && !_amount.errors?.pattern">
                                Value must be greater {{_amount.errors?.min.min}}
                            </span>
                            <span class="error" *ngIf="_amount.errors?.max && !_amount.errors?.pattern">
                                Value must not exceed {{_amount.errors?.max.max}}
                            </span>
                            <span class="error" *ngIf="_amount.errors?.pattern">
                                Value error
                            </span>
                        </div>
                    </div>
                    <div class="info">
                        <div class="title">
                          Transaction Fee:
                        </div>
                        <div class="text">
                          {{_amount.value * currentToken.withdraw.fee_percent + currentToken.withdraw.fee_fixed}} {{currentToken.code}}
                        </div>
                    </div>
                    <div class="info">
                        <div class="title">
                            You will get:
                        </div>
                        <div class="text">
                            {{ _amount.value * ( 1 - currentToken.withdraw.fee_percent) - currentToken.withdraw.fee_fixed }} {{currentToken.code}}
                        </div>
                    </div>
                    <button
                            [disabled]="!withdrawForm.valid"
                            mat-raised-button
                            [ngClass]="{'load': isLoading}"
                            class="button-next">
                            <div *ngIf="isLoading" class=" icon spinner small"></div>
                        <span>{{buttonText}}</span>
                    </button>
                </form>
            </div>

        </div>
    </div>
    <div class="modal-background"></div>
</modal>

<modal id="deposit">
    <div class="modal">
        <div class="modal-body">
            <div class="head-popup">
                Deposit
                <div class="close" (click)="modalService.close('deposit');">
                    <i class="fas fa-times icon-close"></i>
                </div>
            </div>
            <div class="content-popup">
                <div class="operations-modal">
                    <div class="info deposit">
                        <div class="title">
                            Send only {{currentToken.code}} to this deposit address.
                        </div>
                        <div class="text">
                            Sending coin or token other than {{currentToken.code}} to this address may result in the loss of your deposit.
                        </div>
                    </div>
                    <div class="address-wrapper">
                        <div class="info">
                            <div class="title">
                                {{currentToken.code}} Address
                            </div>
                            <div class="address" [ngClass]="{'load': !address}">
                                {{address}}
                                <span [text-copy]="address">
                                    <i class="far fa-clone icon copy"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    <app-crypto-qr [code]="currentToken.code" [address]="address"></app-crypto-qr>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-background"></div>
</modal>

<modal id="prepare-transaction">
    <div class="modal">
        <div class="modal-body">
            <div class="head-popup">
                Prepare transaction
                <div class="close" (click)="modalService.close('prepare-transaction');">
                    <i class="fas fa-times icon-close"></i>
                </div>
            </div>
            <div class="content-popup">
                <div class="operations-modal">
                    <div class="info deposit">
                        <!--<div class="title">-->
                        <!--Prepare transaction-->
                        <!--</div>-->
                        <div class="text">
                            {{ description }}
                        </div>
                    </div>
                    <div class="address-wrapper">
                        <div class="info">
                            <div class="title">
                                Transaction id
                            </div>
                            <div class="address tx" [ngClass]="{'load': !txId}">
                                <span class="tx-id">{{txId}}</span>
                                <span [text-copy]="txId">
                                    <i _ngcontent-lum-c277="" class="far fa-clone icon copy" aria-hidden="true"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    <a target="_blank" [href]="'http://cosmic.link/?xdr=' + txId"
                       class="button-next external-link">
                        <span>Sign</span>
                        <i class="fas fa-external-link-alt external-icon"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-background"></div>
</modal>
